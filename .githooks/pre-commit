#!/bin/bash

#===============================================================================
# Agent Kit - Upstream Protection Pre-Commit Hook
#
# Blocks all commits unless ALLOW_UPSTREAM_COMMIT=1 is explicitly set.
# This prevents accidental commits from cloud sessions or junior devs.
#
# Legitimate workflows (promote.sh, manual admin work) set the env var.
#
# Install: git config core.hooksPath .githooks
# Bypass:  ALLOW_UPSTREAM_COMMIT=1 git commit -m "..."
#===============================================================================

RED='\033[0;31m'
YELLOW='\033[1;33m'
CYAN='\033[0;36m'
BOLD='\033[1m'
NC='\033[0m'

if [[ "$ALLOW_UPSTREAM_COMMIT" != "1" ]]; then
    echo ""
    echo -e "${RED}╔════════════════════════════════════════════════════════════════╗${NC}"
    echo -e "${RED}║${NC}  ${BOLD}UPSTREAM COMMIT BLOCKED${NC}                                      ${RED}║${NC}"
    echo -e "${RED}╠════════════════════════════════════════════════════════════════╣${NC}"
    echo -e "${RED}║${NC}                                                                ${RED}║${NC}"
    echo -e "${RED}║${NC}  This is the ${CYAN}upstream agent-kit template${NC}.                      ${RED}║${NC}"
    echo -e "${RED}║${NC}  Direct commits are ${RED}not allowed${NC}.                                ${RED}║${NC}"
    echo -e "${RED}║${NC}                                                                ${RED}║${NC}"
    echo -e "${RED}║${NC}  ${YELLOW}How to make changes:${NC}                                          ${RED}║${NC}"
    echo -e "${RED}║${NC}    1. Use ${CYAN}/promote${NC} from a downstream project                    ${RED}║${NC}"
    echo -e "${RED}║${NC}    2. See CLAUDE.md for admin procedures                       ${RED}║${NC}"
    echo -e "${RED}║${NC}                                                                ${RED}║${NC}"
    echo -e "${RED}╚════════════════════════════════════════════════════════════════╝${NC}"
    echo ""
    exit 1
fi
